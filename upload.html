<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ระบบอัพโหลดผลงานวิจัย</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    
    @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');
    body {
      font-family: 'Sarabun', sans-serif;
      background-color: #f0f4f8;
    }
    .upload-box {
      border: 2px dashed hsl(27, 93%, 49%);
      transition: all 0.3s ease;
    }
    .upload-box:hover {
      border-color: #db7c0ed5;
      background-color: rgba(231, 134, 23, 0.89);
    }
    .category-item {
      transition: all 0.2s ease;
    }
    .category-item:hover {
      transform: translateY(-2px);
    }
    .category-item.selected {
      border-color: #d47a13;
      background-color: rgb(233, 55, 11);
      color: white;
    }
  </style>
</head>
<body>

<header class="bg-gradient-to-r from-orange-600 to-indigo-700 text-white py-6 shadow-lg">
  <div class="container mx-auto px-4">
    <h1 class="text-3xl font-bold">ระบบอัพโหลดผลงานวิจัย</h1>
    <p class="mt-2 text-orange-100">อัพโหลดและจัดการผลงานวิจัยของคุณได้อย่างง่ายดาย</p>
  </div>
</header>

<main class="container mx-auto px-4 py-8">
  <div class="flex justify-end mb-4">
    <a href="index.html" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
      ← กลับหน้าหลัก
    </a>
  </div>

  <div class="bg-white rounded-lg shadow-lg p-6 md:p-8">
    <h2 class="text-2xl font-semibold text-gray-800 mb-6">อัพโหลดผลงานวิจัยใหม่</h2>
    <form id="research-form">
      <!-- ชื่อผลงาน -->
      <div class="mb-6">
        <label class="block text-gray-700 font-medium mb-2">ชื่อผลงานวิจัย <span class="text-red-500">*</span></label>
        <input type="text" id="title" name="title" class="w-full px-4 py-2 border rounded-lg focus:ring-orange-500 focus:border-orange-500 outline-none" required>
      </div>

      <!-- หมวดหมู่ -->
      <div class="mb-6">
        <label class="block text-gray-700 font-medium mb-2">หมวดหมู่ <span class="text-red-500">*</span></label>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
          <div class="category-item border p-4 rounded-lg text-center cursor-pointer" data-category="survey">สำรวจ</div>
          <div class="category-item border p-4 rounded-lg text-center cursor-pointer" data-category="theory">ทฤษฎี</div>
          <div class="category-item border p-4 rounded-lg text-center cursor-pointer" data-category="experiment">ทดลอง</div>
          <div class="category-item border p-4 rounded-lg text-center cursor-pointer" data-category="invention">ประดิษฐ์</div>
        </div>
        <input type="hidden" id="selected-category" name="category" required>
      </div>

      <!-- กลุ่มข้อมูลอื่น -->
      <div class="grid md:grid-cols-2 gap-6 mb-6">
        <div>
          <label class="block text-gray-700 font-medium mb-2">สาขาวิชา <span class="text-red-500">*</span></label>
          <select id="department" name="department" class="w-full border rounded-lg px-4 py-2 focus:ring-blue-500" required>
            <option value="" disabled selected>เลือกสาขาวิชา</option>
            <option value="computer">คอมพิวเตอร์ธุรกิจ</option>
            <!-- ... -->
          </select>
        </div>
        <div>
          <label class="block text-gray-700 font-medium mb-2">สาขางาน <span class="text-red-500">*</span></label>
          <select id="field" name="field" class="w-full border rounded-lg px-4 py-2 focus:ring-blue-500" required>
            <option value="" disabled selected>เลือกสาขางาน</option>
            <option value="programming">การเขียนโปรแกรม</option>
            <!-- ... -->
          </select>
        </div>
      </div>

      <div class="grid md:grid-cols-2 gap-6 mb-6">
        <div>
          <label class="block text-gray-700 font-medium mb-2">ชั้นปี <span class="text-red-500">*</span></label>
          <select id="year" name="year" class="w-full border rounded-lg px-4 py-2 focus:ring-blue-500" required>
            <option value="" disabled selected>เลือกชั้นปี</option>
            <option>ปวช.1</option><option>ปวช.2</option><option>ปวช.3</option>
          </select>
        </div>
        <div>
          <label class="block text-gray-700 font-medium mb-2">ปีการศึกษา <span class="text-red-500">*</span></label>
          <select id="academic-year" name="academic-year" class="w-full border rounded-lg px-4 py-2 focus:ring-blue-500" required>
            <option value="" disabled selected>เลือกปีการศึกษา</option>
            <option>2566</option><option>2565</option><option>2564</option><option>2563</option>
          </select>
        </div>
      </div>

      <!-- รายชื่อผู้จัดทำ -->
      <div class="mb-6">
        <label class="block text-gray-700 font-medium mb-2">ชื่อผู้จัดทำ <span class="text-red-500">*</span></label>
        <div id="authors-container">
          <div class="author-entry flex items-center gap-4 mb-2">
            <input type="text" name="authors[]" class="flex-1 border rounded-lg px-4 py-2 focus:ring-blue-500" placeholder="ชื่อ-นามสกุล" required>
            <button type="button" class="add-author bg-green-500 text-white px-3 py-2 rounded-lg hover:bg-green-600">
              ＋
            </button>
          </div>
        </div>
      </div>

      <!-- อาจารย์ที่ปรึกษา -->
      <div class="mb-6">
        <label class="block text-gray-700 font-medium mb-2">อาจารย์ที่ปรึกษา <span class="text-red-500">*</span></label>
        <input type="text" id="advisor" name="advisor" class="w-full border rounded-lg px-4 py-2 focus:ring-blue-500" required>
      </div>

      <!-- บทคัดย่อ -->
      <div class="mb-6">
        <label class="block text-gray-700 font-medium mb-2">บทคัดย่อ <span class="text-red-500">*</span></label>
        <textarea id="abstract" name="abstract" rows="4" class="w-full border rounded-lg px-4 py-2 focus:ring-blue-500" required></textarea>
      </div>

      <!-- อัปโหลดไฟล์ -->
      <div class="mb-8">
        <label class="block text-gray-700 font-medium mb-2">อัพโหลดไฟล์ <span class="text-red-500">*</span></label>
        <div class="upload-box bg-gray-50 rounded-lg p-8 text-center cursor-pointer">
          <input type="file" id="file-upload" class="hidden" multiple accept=".pdf,.doc,.docx">
          <div>
            <svg class="h-12 w-12 mx-auto text-blue-500 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16l-4-4m0 0l4-4m-4 4h18"/></svg>
          </div>
          <p class="font-medium text-gray-700">ลากไฟล์หรือคลิกเพื่อเลือก</p>
          <p class="text-sm text-gray-500">รองรับ: PDF, DOC, DOCX (≤10MB/ไฟล์)</p>
        </div>
        <div id="file-list" class="mt-4 space-y-2"></div>
      </div>

      <div class="flex justify-end">
        <button type="button" id="cancel-btn" class="px-6 py-2 bg-gray-200 rounded-lg hover:bg-gray-300 mr-4">ยกเลิก</button>
        <button type="submit" id="submit-btn" class="px-6 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700">อัพโหลด</button>
      </div>
    </form>
  </div>
</main>

<script>
  // เลือกหมวดหมู่
  const categoryItems = document.querySelectorAll('.category-item');
  const selectedCategoryInput = document.getElementById('selected-category');

  categoryItems.forEach(item => {
    item.addEventListener('click', () => {
      categoryItems.forEach(i => i.classList.remove('selected'));
      item.classList.add('selected');
      selectedCategoryInput.value = item.dataset.category;
    });
  });

  // เพิ่ม/ลบรายชื่อผู้จัดทำ
  const authorsContainer = document.getElementById('authors-container');
  authorsContainer.addEventListener('click', e => {
    if(e.target.classList.contains('add-author')) {
      const newAuthorDiv = document.createElement('div');
      newAuthorDiv.className = 'author-entry flex items-center gap-4 mb-2';
      newAuthorDiv.innerHTML = `
        <input type="text" name="authors[]" class="flex-1 border rounded-lg px-4 py-2 focus:ring-blue-500" placeholder="ชื่อ-นามสกุล" required>
        <button type="button" class="remove-author bg-red-500 text-white px-3 py-2 rounded-lg hover:bg-red-600">－</button>
      `;
      authorsContainer.appendChild(newAuthorDiv);
    }
    if(e.target.classList.contains('remove-author')) {
      e.target.parentElement.remove();
    }
  });

  // การเลือกไฟล์และแสดงรายการไฟล์
  const uploadBox = document.querySelector('.upload-box');
  const fileInput = document.getElementById('file-upload');
  const fileListDiv = document.getElementById('file-list');

  uploadBox.addEventListener('click', () => fileInput.click());

  fileInput.addEventListener('change', () => {
    fileListDiv.innerHTML = '';
    for(const file of fileInput.files) {
      if(file.size > 10 * 1024 * 1024) {
        alert(`ไฟล์ "${file.name}" ขนาดเกิน 10MB`);
        fileInput.value = '';
        fileListDiv.innerHTML = '';
        return;
      }
      const fileDiv = document.createElement('div');
      fileDiv.textContent = `${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)`;
      fileDiv.className = 'text-gray-700';
      fileListDiv.appendChild(fileDiv);
    }
  });

  // ปุ่มยกเลิก
  document.getElementById('cancel-btn').addEventListener('click', () => {
    if(confirm('ต้องการยกเลิกและล้างข้อมูลหรือไม่?')) {
      document.getElementById('research-form').reset();
      fileListDiv.innerHTML = '';
      categoryItems.forEach(i => i.classList.remove('selected'));
      selectedCategoryInput.value = '';
      // ลบผู้จัดทำเกินอันแรก
      const authors = authorsContainer.querySelectorAll('.author-entry');
      authors.forEach((author, idx) => {
        if(idx > 0) author.remove();
      });
    }
  });

  // ส่งข้อมูลแบบจำลอง (จะอัปโหลดไฟล์ขึ้น Cloudinary)
  document.getElementById('research-form').addEventListener('submit', async (e) => {
    e.preventDefault();

    // ตรวจสอบว่าเลือกหมวดหมู่
    if (!selectedCategoryInput.value) {
      alert('กรุณาเลือกหมวดหมู่');
      return;
    }
    if(fileInput.files.length === 0) {
      alert('กรุณาเลือกไฟล์อัพโหลด');
      return;
    }

    // เตรียมข้อมูลสำหรับอัพโหลดไฟล์ขึ้น Cloudinary
    const cloudName = 'davuwvefc';  // แก้ไขเป็น Cloudinary cloud name ของคุณ
    const uploadPreset = 'STVC_preset';  // ตั้งค่า unsigned upload preset ใน Cloudinary

    const uploadedFiles = [];

    for(const file of fileInput.files) {
      const formData = new FormData();
      formData.append('file', file);
      formData.append('upload_preset', uploadPreset);

      try {
        const response = await fetch(`https://api.cloudinary.com/v1_1/${cloudName}/upload`, {
          method: 'POST',
          body: formData,
        });
        const data = await response.json();
        if(data.secure_url) {
          uploadedFiles.push(data.secure_url);
        } else {
          alert(`อัพโหลดไฟล์ ${file.name} ล้มเหลว`);
          return;
        }
      } catch(err) {
        alert(`เกิดข้อผิดพลาดในการอัพโหลดไฟล์ ${file.name}`);
        return;
      }
    }

    // ข้อมูลอื่น ๆ จากฟอร์ม
    const formDataToSend = {
      title: document.getElementById('title').value,
      category: selectedCategoryInput.value,
      department: document.getElementById('department').value,
      field: document.getElementById('field').value,
      year: document.getElementById('year').value,
      academicYear: document.getElementById('academic-year').value,
      authors: Array.from(document.querySelectorAll('input[name="authors[]"]')).map(input => input.value),
      advisor: document.getElementById('advisor').value,
      abstract: document.getElementById('abstract').value,
      files: uploadedFiles,
    };

    // จำลองส่งข้อมูลฟอร์มไป server
    console.log('ส่งข้อมูลฟอร์ม', formDataToSend);
    alert('ส่งข้อมูลเรียบร้อยแล้ว! ตรวจสอบ Console log');

    // ล้างฟอร์ม
    document.getElementById('research-form').reset();
    fileListDiv.innerHTML = '';
    categoryItems.forEach(i => i.classList.remove('selected'));
    selectedCategoryInput.value = '';
    const authors = authorsContainer.querySelectorAll('.author-entry');
    authors.forEach((author, idx) => {
      if(idx > 0) author.remove();
    });
  });
</script>

</body>
</html>
